<!DOCTYPE html>
<html lang="en-US">

  
<!-- Mirrored from qb64.com/wiki/DECLARE-DYNAMIC-LIBRARY by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 07 Nov 2024 13:13:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.html">
    <link rel="stylesheet" type="text/css" media="screen" href="../assets/css/style2443.css?v=eb9b8c9cad488bd1304035e1bfc5d2e89b0f78df">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>QB64.com | QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS.</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="QB64.com" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS." />
<meta property="og:description" content="QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS." />
<link rel="canonical" href="DECLARE-DYNAMIC-LIBRARY-2.html" />
<meta property="og:url" content="DECLARE-DYNAMIC-LIBRARY-2.html" />
<meta property="og:site_name" content="QB64.com" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="QB64.com" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS.","headline":"QB64.com","url":"https://qb64.com/wiki/DECLARE-DYNAMIC-LIBRARY.html"}</script>
<!-- End Jekyll SEO tag -->

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          
            <!--<a id="forkme_banner" href="https://github.com/DualBrain/QB64">View on GitHub</a>-->
          

          <h1 id="project_title">QB64.com</h1>
          <h2 id="project_tagline">QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS.</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><strong>DECLARE DYNAMIC LIBRARY</strong> allows you to dynamically link your program to functions in dynamically linkable libraries. At present, ‘<strong>.dll</strong>’ , ‘<strong>.so</strong>’ and ‘<strong>.dylib</strong>’ files are supported. These libraries are loaded when your program begins. For <strong>STATIC</strong> library’s ‘<strong>.lib</strong>’, ‘<strong>.h</strong>’, ‘<strong>.hpp</strong>’, ‘<strong>.a</strong>’, ‘<strong>.o</strong>’ and ‘<strong>.dylib</strong>’ files are also supported.</p>

<h2 id="syntax">Syntax</h2>

<blockquote>
  <table>
    <tbody>
      <tr>
        <td><strong>DECLARE</strong> [<strong>DYNAMIC</strong></td>
        <td><strong>CUSTOMTYPE</strong></td>
        <td><strong>STATIC</strong>] <strong>LIBRARY</strong> [<em>“Library_file”</em>,<em>“other_lib_files”</em>]</td>
      </tr>
    </tbody>
  </table>

  <blockquote>
    <table>
      <tbody>
        <tr>
          <td>{<a href="SUB.html">SUB</a></td>
          <td><a href="FUNCTION.html">FUNCTION</a>} [<em>procedure_name</em> <strong>ALIAS</strong>] <em>library_procedure</em> (<strong>BYVAL</strong> <em>parameter(s)</em> <a href="AS.html">AS</a> varType,…)</td>
        </tr>
      </tbody>
    </table>

    <p>… ‘other Library sub-procedures for named <em>DLL</em></p>
  </blockquote>

  <p><strong>END DECLARE</strong></p>
</blockquote>

<h2 id="description">Description</h2>

<ul>
  <li>The dynamic library file can be located in the QB64 folder (alongside your programs ‘.EXE’), in Windows’ system32 folder, or in a relative/absolute path specified along with the library name.</li>
  <li><strong>Declarations must be made at the program start and only one file can be specified in each declaration block.</strong></li>
  <li><em>Library_file</em> is the <em>library</em> file’s name with a specified path when not in the QB64 or in the WINDOWS\SYSTEM32 folder. <strong>Don’t add the file extension</strong>.</li>
  <li><em>Library filename</em>s can be listed to combine more than one DLL or Header file name or path into one DECLARE LIBRARY block.</li>
  <li><em>Procedure_name</em> is any procedure name you want to designate by using <a href="ALIAS.html">ALIAS</a> with the <em>Library_procedure</em> name following.</li>
  <li><em>Parameters</em> used by the Library procedure must be passed by value (<a href="BYVAL.html">BYVAL</a>) except for <a href="STRING.html">STRING</a> values.</li>
  <li><strong><em>.h</em> header files cannot be used with DECLARE DYNAMIC LIBRARY. Existence of any <em>.h</em> file of the same name as the <em>.DLL</em> file will cause DECLARE DYNAMIC LIBRARY to fail.</strong></li>
  <li><strong>IMPORTANT:</strong> <a href="DECLARE-DYNAMIC-LIBRARY.html">DECLARE DYNAMIC LIBRARY</a> let’s you specify any SUB/FUNCTION calling with the format you wish, but **if the size of the parameter list does not match the size expected within the library, then your code will probably cause a GPF (General Protection Fault).</li>
  <li><strong>STATIC</strong> is the same as <a href="DECLARE-LIBRARY.html">DECLARE LIBRARY</a> except that it prioritizes linking to static libraries (<em>.a/</em>.o) over shared object (*.so) libraries, if both exist. As Windows doesn’t really use shared libraries (DLLs are a bit different) this does not affect Windows users.</li>
  <li>The <a href="_OFFSET.html">_OFFSET</a> in memory can be used in <strong>CUSTOMTYPE</strong>, <strong>STATIC</strong> and <strong>DYNAMIC LIBRARY</strong> declarations.</li>
  <li><a href="SUB.html">SUB</a> procedures using DECLARE CUSTOMTYPE LIBRARY API procedures <strong>may error</strong>. Try DYNAMIC with the DLL name.</li>
  <li>Declarations can be made inside of <a href="SUB.html">SUB</a> or <a href="FUNCTION.html">FUNCTION</a> procedures. Declarations do not need to be at program start.</li>
  <li><strong>NOTE: It is up to the user to document and determine the suitability of all Libraries and procedures they choose to use. QB64 cannot guarantee that any procedure will work and cannot quarantee any troubleshooting help.</strong></li>
</ul>

<h2 id="availability">Availability</h2>

<ul>
  <li>Version 0.923 and up (Windows).</li>
  <li>Version 0.94 and up (Linux and macOS).</li>
</ul>

<h2 id="examples">Example(s)</h2>

<p>This example plays Midi files using the <em>playmidi32.dll</em> documented here: [http://libertybasicuniversity.com/lbnews/nl110/midi3.htm Liberty Basic University]. Download the following DLL file to your main QB64 folder: [https://www.qb64.org/resources/Playmidi32.dll PlayMidi32.dll]</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">DECLARE</span> <span class="n">DYNAMIC</span> <span class="n">LIBRARY</span> <span class="s">"playmidi32"</span>
    <span class="n">FUNCTION</span> <span class="n">PlayMIDI</span><span class="o">&amp;</span> <span class="p">(</span><span class="n">filename</span> <span class="n">AS</span> <span class="n">STRING</span><span class="p">)</span>
<span class="n">END</span> <span class="n">DECLARE</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">PlayMIDI</span><span class="p">(</span><span class="s">".\samples\qb64\original\ps2battl.mid"</span> <span class="o">+</span> <span class="n">CHR</span><span class="err">$</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">PRINT</span> <span class="n">result</span>

</code></pre></div></div>

<blockquote>
  <p><strong>Note:</strong> Filename needs to be <a href="CHR%24.html">CHR$</a>(0) terminated. QB64 <a href="STRING.html">STRING</a>s are passed to external libraries as pointers to first character.</p>
</blockquote>

<p>Using a CUSTOMTYPE LIBRARY to return the <a href="Unicode.html">Unicode</a> version of the current running program’s name.</p>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">SCREEN</span> <span class="mi">12</span>

<span class="n">DECLARE</span> <span class="n">CUSTOMTYPE</span> <span class="n">LIBRARY</span> <span class="c1">'Directory Information using KERNEL32 provided by Dav</span>
    <span class="n">FUNCTION</span> <span class="n">GetModuleFileNameA</span><span class="o">&amp;</span> <span class="p">(</span><span class="n">BYVAL</span> <span class="n">hModule</span> <span class="n">AS</span> <span class="n">LONG</span><span class="p">,</span> <span class="n">lpFileName</span> <span class="n">AS</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">BYVAL</span> <span class="n">nSize</span> <span class="n">AS</span> <span class="n">LONG</span><span class="p">)</span>
    <span class="n">FUNCTION</span> <span class="n">GetModuleFileNameW</span><span class="o">&amp;</span> <span class="p">(</span><span class="n">BYVAL</span> <span class="n">hModule</span> <span class="n">AS</span> <span class="n">LONG</span><span class="p">,</span> <span class="n">lpFileName</span> <span class="n">AS</span> <span class="n">STRING</span><span class="p">,</span> <span class="n">BYVAL</span> <span class="n">nSize</span> <span class="n">AS</span> <span class="n">LONG</span><span class="p">)</span>
<span class="n">END</span> <span class="n">DECLARE</span>

<span class="c1">'=== SHOW CURRENT PROGRAM</span>
<span class="n">FileName</span><span class="err">$</span> <span class="o">=</span> <span class="n">SPACE</span><span class="err">$</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>

<span class="n">Result</span> <span class="o">=</span> <span class="n">GetModuleFileNameA</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FileName</span><span class="err">$</span><span class="p">,</span> <span class="n">LEN</span><span class="p">(</span><span class="n">FileName</span><span class="err">$</span><span class="p">))</span>
<span class="n">IF</span> <span class="n">Result</span> <span class="n">THEN</span> <span class="n">PRINT</span> <span class="s">"CURRENT PROGRAM (ASCII): "</span><span class="err">;</span> <span class="n">LEFT</span><span class="err">$</span><span class="p">(</span><span class="n">FileName</span><span class="err">$</span><span class="p">,</span> <span class="n">Result</span><span class="p">)</span>

<span class="c1">'load a unicode font</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">_LOADFONT</span><span class="p">(</span><span class="s">"cyberbit.ttf"</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s">"UNICODE"</span><span class="p">)</span>
<span class="n">_FONT</span> <span class="n">f</span>
<span class="n">Result</span> <span class="o">=</span> <span class="n">GetModuleFileNameW</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FileName</span><span class="err">$</span><span class="p">,</span> <span class="n">LEN</span><span class="p">(</span><span class="n">FileName</span><span class="err">$</span><span class="p">)</span> <span class="o">\</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">LOCATE</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>
<span class="n">PRINT</span> <span class="n">QuickCP437toUTF32</span><span class="err">$</span><span class="p">(</span><span class="s">"CURRENT PROGRAM (UTF): "</span><span class="p">)</span> <span class="o">+</span> <span class="n">QuickUTF16toUTF32</span><span class="err">$</span><span class="p">(</span><span class="n">LEFT</span><span class="err">$</span><span class="p">(</span><span class="n">FileName</span><span class="err">$</span><span class="p">,</span> <span class="n">Result</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">_FONT</span> <span class="mi">16</span> <span class="c1">'restore CP437 font</span>

<span class="n">FUNCTION</span> <span class="n">QuickCP437toUTF32</span><span class="err">$</span> <span class="p">(</span><span class="n">a$</span><span class="p">)</span>
<span class="n">b$</span> <span class="o">=</span> <span class="n">STRING</span><span class="err">$</span><span class="p">(</span><span class="n">LEN</span><span class="p">(</span><span class="n">a$</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">FOR</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="n">LEN</span><span class="p">(</span><span class="n">a$</span><span class="p">)</span>
    <span class="n">ASC</span><span class="p">(</span><span class="n">b$</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ASC</span><span class="p">(</span><span class="n">a$</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">NEXT</span>
<span class="n">QuickCP437toUTF32</span><span class="err">$</span> <span class="o">=</span> <span class="n">b$</span>
<span class="n">END</span> <span class="n">FUNCTION</span>

<span class="n">FUNCTION</span> <span class="n">QuickUTF16toUTF32</span><span class="err">$</span> <span class="p">(</span><span class="n">a$</span><span class="p">)</span>
<span class="n">b$</span> <span class="o">=</span> <span class="n">STRING</span><span class="err">$</span><span class="p">(</span><span class="n">LEN</span><span class="p">(</span><span class="n">a$</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">FOR</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="n">LEN</span><span class="p">(</span><span class="n">a$</span><span class="p">)</span> <span class="o">\</span> <span class="mi">2</span>
    <span class="n">ASC</span><span class="p">(</span><span class="n">b$</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">ASC</span><span class="p">(</span><span class="n">a$</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ASC</span><span class="p">(</span><span class="n">b$</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ASC</span><span class="p">(</span><span class="n">a$</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">NEXT</span>
<span class="n">QuickUTF16toUTF32</span><span class="err">$</span> <span class="o">=</span> <span class="n">b$</span>
<span class="n">END</span> <span class="n">FUNCTION</span> 

</code></pre></div></div>

<blockquote>
  <p><strong>Note:</strong> SUB procedures using CUSTOMTYPE LIBRARY API procedures inside may error. Try DYNAMIC with “KERNEL32”.</p>
</blockquote>

<p><strong>QB64 version 1.000 and up produce standalone executables. External DLL files must be distributed with your program.</strong>
<strong>Note: QB64 versions prior to 1.000 require all default DLL files to either be with the program or in the C:\WINDOWS\SYSTEM32 folder.</strong></p>

<h2 id="see-also">See Also</h2>

<ul>
  <li><a href="DECLARE-LIBRARY.html">DECLARE LIBRARY</a></li>
  <li><a href="SUB.html">SUB</a>, <a href="FUNCTION.html">FUNCTION</a></li>
  <li><a href="BYVAL.html">BYVAL</a>, <a href="ALIAS.html">ALIAS</a></li>
  <li><a href="_OFFSET-(function).html">_OFFSET (function)</a>, <a href="_OFFSET.html">_OFFSET</a> (variable type)</li>
  <li><a href="C-Libraries.html">C Libraries</a>, <a href="DLL-Libraries.html">DLL Libraries</a>, <a href="Windows-Libraries.html">Windows Libraries</a></li>
  <li><a href="Port-Access-Libraries.html">Port Access Libraries</a></li>
</ul>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">QB64.com maintained by <a href="https://github.com/DualBrain">Cory Smith</a> on <a href="https://github.com/DualBrain/QB64">GitHub</a>.</p>
        
        <p>Published with <a href="https://pages.github.com/">GitHub Pages</a></p>
      </footer>
    </div>
  </body>

<!-- Mirrored from qb64.com/wiki/DECLARE-DYNAMIC-LIBRARY by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 07 Nov 2024 13:13:54 GMT -->
</html>