<!DOCTYPE html>
<html lang="en-US">

  
<!-- Mirrored from qb64.com/wiki/Downloading-Files by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 07 Nov 2024 13:50:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.html">
    <link rel="stylesheet" type="text/css" media="screen" href="../assets/css/style2443.css?v=eb9b8c9cad488bd1304035e1bfc5d2e89b0f78df">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>QB64.com | QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS.</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="QB64.com" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS." />
<meta property="og:description" content="QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS." />
<link rel="canonical" href="Downloading-Files-2.html" />
<meta property="og:url" content="Downloading-Files-2.html" />
<meta property="og:site_name" content="QB64.com" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="QB64.com" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS.","headline":"QB64.com","url":"https://qb64.com/wiki/Downloading-Files.html"}</script>
<!-- End Jekyll SEO tag -->

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          
            <!--<a id="forkme_banner" href="https://github.com/DualBrain/QB64">View on GitHub</a>-->
          

          <h1 id="project_title">QB64.com</h1>
          <h2 id="project_tagline">QB64 is a modern extended BASIC programming language that retains QBasic/QuickBASIC 4.5 compatibility and compiles native binaries for Windows, Linux, and macOS.</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><strong>HTTP/1.1</strong> protocol downloads can be done using a <strong>GET</strong> request using the following format without HTTP:// in the url:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
CRLF$ = CHR$(13) + CHR$(10)
Request$ = "GET " + File_Path + " HTTP/1.1" + CRLF$ + "Host:" + Web_Address + CRLF$ + CRLF$

</code></pre></div></div>

<blockquote>
  <p>Two carriage returns end the request to the <a href="_OPENCLIENT.html">_OPENCLIENT</a> URL. The header that is returned from the site also ends with two carriage returns when there are no errors. The header will also include the requested file’s byte size after “content-length:” as below:</p>
</blockquote>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
HTTP/1.1 200 OK
Server: dbws
Date: Tue, 25 Oct 2011 04:41:03 GMT
Content-Type: text/plain; charset=ascii
Connection: keep-alive
content-length: 4087
x-robots-tag: noindex,nofollow
accept-ranges: bytes
etag: 365n
pragma: public
cache-control: max-age=0 

</code></pre></div></div>

<blockquote>
  <p>Each row of text response sent is ended with a carriage return with the end of header having two. After that comes the file data.
 It is recommended that data be loaded immediately by using a <a href="GET-(TCP-IP-statement).html">GET (TCP/IP statement)</a> loop so that connections are not dropped during a <a href="_DELAY.html">_DELAY</a>.</p>
</blockquote>

<blockquote>
  <p><strong>A “raw” Download function that downloads an image directly off of a web page using the image name on that page.</strong></p>
</blockquote>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">IF</span> <span class="n">Download</span><span class="p">(</span><span class="s">"www.qb64.net/qb64.png"</span><span class="p">,</span> <span class="s">"qb64logo.png"</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="n">THEN</span> <span class="c1">' timelimit = 10 seconds</span>
 <span class="n">SCREEN</span> <span class="n">_LOADIMAGE</span><span class="p">(</span><span class="s">"qb64logo.png"</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span>
<span class="n">ELSE</span><span class="p">:</span> <span class="n">PRINT</span> <span class="s">"Couldn't download QB64 logo."</span>
<span class="n">END</span> <span class="n">IF</span>
<span class="n">SLEEP</span>
<span class="n">SYSTEM</span>

<span class="c1">' ---------- program end -----------</span>

<span class="n">FUNCTION</span> <span class="n">Download</span> <span class="p">(</span><span class="n">url$</span><span class="p">,</span> <span class="n">file$</span><span class="p">,</span> <span class="n">timelimit</span><span class="p">)</span> <span class="c1">' returns -1 if successful, 0 if not</span>
<span class="n">url2$</span> <span class="o">=</span> <span class="n">url$</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">url2$</span><span class="p">,</span> <span class="s">"/"</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">x</span> <span class="n">THEN</span> <span class="n">url2$</span> <span class="o">=</span> <span class="n">LEFT</span><span class="err">$</span><span class="p">(</span><span class="n">url$</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">_OPENCLIENT</span><span class="p">(</span><span class="s">"TCP/IP:80:"</span> <span class="o">+</span> <span class="n">url2$</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">client</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">THEN</span> <span class="n">EXIT</span> <span class="n">FUNCTION</span>
<span class="n">e$</span> <span class="o">=</span> <span class="n">CHR</span><span class="err">$</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="n">CHR</span><span class="err">$</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">' end of line characters</span>
<span class="n">url3$</span> <span class="o">=</span> <span class="n">RIGHT</span><span class="err">$</span><span class="p">(</span><span class="n">url$</span><span class="p">,</span> <span class="n">LEN</span><span class="p">(</span><span class="n">url$</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x$</span> <span class="o">=</span> <span class="s">"GET "</span> <span class="o">+</span> <span class="n">url3$</span> <span class="o">+</span> <span class="s">" HTTP/1.1"</span> <span class="o">+</span> <span class="n">e$</span>
<span class="n">x$</span> <span class="o">=</span> <span class="n">x$</span> <span class="o">+</span> <span class="s">"Host: "</span> <span class="o">+</span> <span class="n">url2$</span> <span class="o">+</span> <span class="n">e$</span> <span class="o">+</span> <span class="n">e$</span>
<span class="n">PUT</span> <span class="p">#</span><span class="n">client</span><span class="p">,</span> <span class="p">,</span> <span class="n">x$</span>
<span class="n">t!</span> <span class="o">=</span> <span class="n">TIMER</span> <span class="c1">' start time</span>
<span class="n">DO</span>
    <span class="n">_DELAY</span> <span class="mf">0.05</span> <span class="c1">' 50ms delay (20 checks per second)</span>
    <span class="n">GET</span> <span class="p">#</span><span class="n">client</span><span class="p">,</span> <span class="p">,</span> <span class="n">a2$</span>
    <span class="n">a$</span> <span class="o">=</span> <span class="n">a$</span> <span class="o">+</span> <span class="n">a2$</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">a$</span><span class="p">,</span> <span class="s">"Content-Length:"</span><span class="p">)</span>
    <span class="n">IF</span> <span class="n">i</span> <span class="n">THEN</span>
      <span class="n">i2</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a$</span><span class="p">,</span> <span class="n">e$</span><span class="p">)</span>
      <span class="n">IF</span> <span class="n">i2</span> <span class="n">THEN</span>
      <span class="n">l</span> <span class="o">=</span> <span class="n">VAL</span><span class="p">(</span><span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">a$</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">15</span><span class="p">,</span> <span class="n">i2</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span><span class="mi">14</span><span class="p">))</span>
      <span class="n">i3</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">i2</span><span class="p">,</span> <span class="n">a$</span><span class="p">,</span> <span class="n">e$</span> <span class="o">+</span> <span class="n">e$</span><span class="p">)</span>
        <span class="n">IF</span> <span class="n">i3</span> <span class="n">THEN</span>
          <span class="n">i3</span> <span class="o">=</span> <span class="n">i3</span> <span class="o">+</span> <span class="mi">4</span> <span class="c1">'move i3 to start of data</span>
          <span class="n">IF</span> <span class="p">(</span><span class="n">LEN</span><span class="p">(</span><span class="n">a$</span><span class="p">)</span> <span class="o">-</span> <span class="n">i3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">l</span> <span class="n">THEN</span>
            <span class="n">CLOSE</span> <span class="n">client</span> <span class="c1">' CLOSE CLIENT</span>
            <span class="n">d$</span> <span class="o">=</span> <span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">a$</span><span class="p">,</span> <span class="n">i3</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="n">FREEFILE</span>
            <span class="n">OPEN</span> <span class="n">file$</span> <span class="n">FOR</span> <span class="n">OUTPUT</span> <span class="n">AS</span> <span class="p">#</span><span class="n">fh</span><span class="p">:</span> <span class="n">CLOSE</span> <span class="p">#</span><span class="n">fh</span> <span class="c1">'Warning! Clears data from existing file</span>
            <span class="n">OPEN</span> <span class="n">file$</span> <span class="n">FOR</span> <span class="n">BINARY</span> <span class="n">AS</span> <span class="p">#</span><span class="n">fh</span>
            <span class="n">PUT</span> <span class="p">#</span><span class="n">fh</span><span class="p">,</span> <span class="p">,</span> <span class="n">d$</span>
            <span class="n">CLOSE</span> <span class="p">#</span><span class="n">fh</span>
            <span class="n">Download</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">'indicates download was successfull</span>
            <span class="n">EXIT</span> <span class="n">FUNCTION</span>
          <span class="n">END</span> <span class="n">IF</span> <span class="c1">' availabledata = l</span>
        <span class="n">END</span> <span class="n">IF</span> <span class="c1">' i3</span>
      <span class="n">END</span> <span class="n">IF</span> <span class="c1">' i2</span>
    <span class="n">END</span> <span class="n">IF</span> <span class="c1">' i</span>
<span class="n">LOOP</span> <span class="n">UNTIL</span> <span class="n">TIMER</span> <span class="o">&gt;</span> <span class="n">t!</span> <span class="o">+</span> <span class="n">timelimit</span> <span class="c1">' (in seconds)</span>
<span class="n">CLOSE</span> <span class="n">client</span>
<span class="n">END</span> <span class="n">FUNCTION</span> 

</code></pre></div></div>
<p><sub>Code by Galleon</sub></p>

<blockquote>
  <p><strong>Downloading a <a href="BINARY.html">BINARY</a> image file from a download link using <a href="GET.html">GET</a> which requires the “content-length” in header.</strong></p>
</blockquote>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">DEFINT</span> <span class="n">A</span><span class="o">-</span><span class="n">Z</span>

<span class="n">CR</span><span class="err">$</span> <span class="o">=</span> <span class="n">CHR</span><span class="err">$</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="n">CHR</span><span class="err">$</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">'crlf carriage return line feed characters</span>
<span class="c1">' Change this to the file's public link</span>
<span class="o">&lt;</span><span class="n">nowiki</span><span class="o">&gt;</span><span class="n">DownFile</span><span class="err">$</span> <span class="o">=</span> <span class="s">"http://a5.sphotos.ak.fbcdn.net/hphotos-ak-snc7/293944_10150358253659788_151813304787_8043392_486717139_n.jpg?dl=1"</span><span class="o">&lt;/</span><span class="n">nowiki</span><span class="o">&gt;</span>

<span class="c1">' Get base URL</span>
<span class="n">BaseURL</span><span class="err">$</span> <span class="o">=</span> <span class="n">DownFile</span><span class="err">$</span>
<span class="n">IF</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">BaseURL</span><span class="err">$</span><span class="p">,</span> <span class="s">"http://"</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">BaseURL</span><span class="err">$</span> <span class="o">=</span> <span class="n">RIGHT</span><span class="err">$</span><span class="p">(</span><span class="n">BaseURL</span><span class="err">$</span><span class="p">,</span> <span class="n">LEN</span><span class="p">(</span><span class="n">BaseURL</span><span class="err">$</span><span class="p">)</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span> <span class="c1">'trim http://</span>
<span class="n">Path</span><span class="err">$</span> <span class="o">=</span> <span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">BaseURL</span><span class="err">$</span><span class="p">,</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">BaseURL</span><span class="err">$</span><span class="p">,</span> <span class="s">"/"</span><span class="p">))</span> <span class="c1">'path to file</span>
<span class="n">BaseURL</span><span class="err">$</span> <span class="o">=</span> <span class="n">LEFT</span><span class="err">$</span><span class="p">(</span><span class="n">BaseURL</span><span class="err">$</span><span class="p">,</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">BaseURL</span><span class="err">$</span><span class="p">,</span> <span class="s">"/"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">'site URL</span>

<span class="c1">' Connect to base URL</span>
<span class="n">PRINT</span> <span class="s">"Connecting to "</span><span class="err">;</span> <span class="n">BaseURL</span><span class="err">$;</span> <span class="s">"..."</span><span class="err">;</span>
<span class="n">Client</span><span class="o">&amp;</span> <span class="o">=</span> <span class="n">_OPENCLIENT</span><span class="p">(</span><span class="s">"TCP/IP:80:"</span> <span class="o">+</span> <span class="n">BaseURL</span><span class="err">$</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">Client</span><span class="o">&amp;</span> <span class="o">=</span> <span class="mi">0</span> <span class="n">THEN</span> <span class="n">PRINT</span> <span class="s">"Failed to connect..."</span><span class="p">:</span> <span class="n">END</span>
<span class="n">PRINT</span> <span class="s">"Done."</span>

<span class="c1">' Send download request</span>
<span class="n">PRINT</span> <span class="s">"Sending download request..."</span><span class="err">;</span>
<span class="n">Request</span><span class="err">$</span> <span class="o">=</span> <span class="s">"GET "</span> <span class="o">+</span> <span class="n">Path</span><span class="err">$</span> <span class="o">+</span> <span class="s">" HTTP/1.1"</span> <span class="o">+</span> <span class="n">CR</span><span class="err">$</span> <span class="o">+</span> <span class="s">"Host:"</span> <span class="o">+</span> <span class="n">BaseURL</span><span class="err">$</span> <span class="o">+</span> <span class="n">CR</span><span class="err">$</span> <span class="o">+</span> <span class="n">CR</span><span class="err">$</span>
<span class="n">PUT</span> <span class="p">#</span><span class="n">Client</span><span class="o">&amp;</span><span class="p">,</span> <span class="p">,</span> <span class="n">Request</span><span class="err">$</span>
<span class="n">PRINT</span> <span class="s">"Done."</span>

<span class="c1">' Download the header</span>
<span class="n">PRINT</span> <span class="s">"Getting HTML header..."</span><span class="err">;</span>
<span class="n">Dat</span><span class="err">$</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">DO</span>
   <span class="n">_LIMIT</span> <span class="mi">20</span>
   <span class="n">GET</span> <span class="p">#</span><span class="n">Client</span><span class="o">&amp;</span><span class="p">,</span> <span class="p">,</span> <span class="n">gDat$</span>
   <span class="n">Dat</span><span class="err">$</span> <span class="o">=</span> <span class="n">Dat</span><span class="err">$</span> <span class="o">+</span> <span class="n">gDat$</span>
<span class="n">LOOP</span> <span class="n">UNTIL</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">Dat</span><span class="err">$</span><span class="p">,</span> <span class="n">CR</span><span class="err">$</span> <span class="o">+</span> <span class="n">CR</span><span class="err">$</span><span class="p">)</span> <span class="c1">' Loop until 2 CRLFs (end of HTML header) are found</span>
<span class="n">PRINT</span> <span class="s">"Done."</span>

<span class="c1">' Get file size</span>
<span class="n">FileSizePos</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">UCASE</span><span class="err">$</span><span class="p">(</span><span class="n">Dat</span><span class="err">$</span><span class="p">),</span> <span class="s">"CONTENT-LENGTH: "</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span>
<span class="n">FileSizeEnd</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">FileSizePos</span><span class="p">,</span> <span class="n">Dat</span><span class="err">$</span><span class="p">,</span> <span class="n">CR</span><span class="err">$</span><span class="p">)</span>
<span class="n">FileSize</span><span class="o">&amp;</span> <span class="o">=</span> <span class="n">VAL</span><span class="p">(</span><span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">Dat</span><span class="err">$</span><span class="p">,</span> <span class="n">FileSizePos</span><span class="p">,</span> <span class="p">(</span><span class="n">FileSizeEnd</span> <span class="o">-</span> <span class="n">FileSizePos</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">PRINT</span> <span class="s">"File size:"</span><span class="err">;</span> <span class="n">FileSize</span><span class="o">&amp;</span>
<span class="n">PRINT</span> <span class="s">"Downloading file..."</span><span class="err">;</span>

<span class="c1">' Trim off HTML header</span>
<span class="n">EndHeaderPos</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">Dat</span><span class="err">$</span><span class="p">,</span> <span class="n">CR</span><span class="err">$</span> <span class="o">+</span> <span class="n">CR</span><span class="err">$</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
<span class="n">Dat</span><span class="err">$</span> <span class="o">=</span> <span class="n">RIGHT</span><span class="err">$</span><span class="p">(</span><span class="n">Dat</span><span class="err">$</span><span class="p">,</span> <span class="p">(</span><span class="n">LEN</span><span class="p">(</span><span class="n">Dat</span><span class="err">$</span><span class="p">)</span> <span class="o">-</span> <span class="n">EndHeaderPos</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">' Get the file name tucked at the end of the URL if necessary</span>
<span class="n">FOR</span> <span class="n">S</span> <span class="o">=</span> <span class="n">LEN</span><span class="p">(</span><span class="n">DownFile</span><span class="err">$</span><span class="p">)</span> <span class="n">TO</span> <span class="mi">1</span> <span class="n">STEP</span> <span class="o">-</span><span class="mi">1</span>
   <span class="n">IF</span> <span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">DownFile</span><span class="err">$</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s">"/"</span> <span class="n">THEN</span>
      <span class="n">OutFile</span><span class="err">$</span> <span class="o">=</span> <span class="n">RIGHT</span><span class="err">$</span><span class="p">(</span><span class="n">DownFile</span><span class="err">$</span><span class="p">,</span> <span class="p">(</span><span class="n">LEN</span><span class="p">(</span><span class="n">DownFile</span><span class="err">$</span><span class="p">)</span> <span class="o">-</span> <span class="n">S</span><span class="p">))</span>
      <span class="n">EXIT</span> <span class="n">FOR</span>
   <span class="n">END</span> <span class="n">IF</span>
<span class="n">NEXT</span> <span class="n">S</span>
<span class="c1">' Remove some kind of tag at the end of the file name in some URLs</span>
<span class="n">IF</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">OutFile</span><span class="err">$</span><span class="p">,</span> <span class="s">"?"</span><span class="p">)</span> <span class="n">THEN</span> <span class="n">OutFile</span><span class="err">$</span> <span class="o">=</span> <span class="n">LEFT</span><span class="err">$</span><span class="p">(</span><span class="n">OutFile</span><span class="err">$</span><span class="p">,</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">OutFile</span><span class="err">$</span><span class="p">,</span> <span class="s">"?"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">' Download the rest of the data</span>
<span class="n">OPEN</span> <span class="n">OutFile</span><span class="err">$</span> <span class="n">FOR</span> <span class="n">OUTPUT</span> <span class="n">AS</span> <span class="p">#</span><span class="mi">1</span><span class="p">:</span> <span class="n">CLOSE</span> <span class="p">#</span><span class="mi">1</span> <span class="c1">'Warning! Clears data from an existing file</span>
<span class="n">OPEN</span> <span class="n">OutFile</span><span class="err">$</span> <span class="n">FOR</span> <span class="n">BINARY</span> <span class="n">AS</span> <span class="p">#</span><span class="mi">1</span> <span class="c1">'write data to binary image file</span>
<span class="n">DO</span>
   <span class="n">_LIMIT</span> <span class="mi">20</span>
   <span class="n">PUT</span> <span class="p">#</span><span class="mi">1</span><span class="p">,</span> <span class="p">,</span> <span class="n">Dat</span><span class="err">$</span>
   <span class="n">GET</span> <span class="p">#</span><span class="n">Client</span><span class="o">&amp;</span><span class="p">,</span> <span class="p">,</span> <span class="n">Dat</span><span class="err">$</span>
<span class="n">LOOP</span> <span class="n">UNTIL</span> <span class="n">LOF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">FileSize</span><span class="o">&amp;</span>
<span class="n">CLOSE</span> <span class="p">#</span><span class="mi">1</span><span class="p">,</span> <span class="p">#</span><span class="n">Client</span><span class="o">&amp;</span>
<span class="n">PRINT</span> <span class="s">"Done!"</span> 

</code></pre></div></div>
<p><sub>Adapted from code by Jobert14</sub></p>

<blockquote>
  <p><strong>Note:</strong> Some download links require that a <strong>tag</strong> be added after the file name. Remove that tag if it will be used as the file name.</p>
</blockquote>

<blockquote>
  <p><strong>Downloading a sequencial text file from a Drop Box download link using HTTP GET and the  <a href="GET-(TCP-IP-statement).html">GET (TCP/IP statement)</a> statement.</strong></p>
</blockquote>

<div class="language-vb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">CrLf</span><span class="err">$</span> <span class="o">=</span> <span class="n">CHR</span><span class="err">$</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="n">CHR</span><span class="err">$</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1">' carriage return + line feed ASCII characters</span>

<span class="n">Host</span> <span class="o">=</span> <span class="n">_OPENHOST</span><span class="p">(</span><span class="s">"TCP/IP:319"</span><span class="p">)</span>
<span class="n">IF</span> <span class="n">Host</span> <span class="n">THEN</span>
  <span class="n">PRINT</span> <span class="s">"&gt; Server started succesfully."</span>

  <span class="c1">'// Change this to the file's public link</span>
  <span class="n">IP_File</span><span class="err">$</span> <span class="o">=</span> <span class="s">"dl.dropbox.com/u/8440706/QB64.INI"</span> <span class="c1">'a Drop Box link</span>
  <span class="n">URL</span><span class="err">$</span> <span class="o">=</span> <span class="n">LEFT</span><span class="err">$</span><span class="p">(</span><span class="n">IP_File</span><span class="err">$</span><span class="p">,</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">IP_File</span><span class="err">$</span><span class="p">,</span> <span class="s">"/"</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">Path</span><span class="err">$</span> <span class="o">=</span> <span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">IP_File</span><span class="err">$</span><span class="p">,</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">IP_File</span><span class="err">$</span><span class="p">,</span> <span class="s">"/"</span><span class="p">))</span>
  <span class="n">Client</span><span class="o">&amp;</span> <span class="o">=</span> <span class="n">_OPENCLIENT</span><span class="p">(</span><span class="s">"TCP/IP:80:"</span> <span class="o">+</span> <span class="n">URL</span><span class="err">$</span><span class="p">)</span>
  <span class="n">IF</span> <span class="n">Client</span><span class="o">&amp;</span> <span class="n">THEN</span>
    <span class="n">Request</span><span class="err">$</span> <span class="o">=</span> <span class="s">"GET "</span> <span class="o">+</span> <span class="n">Path</span><span class="err">$</span> <span class="o">+</span> <span class="s">" HTTP/1.1"</span> <span class="o">+</span> <span class="n">CrLf</span><span class="err">$</span> <span class="o">+</span> <span class="s">"Host:"</span> <span class="o">+</span> <span class="n">URL</span><span class="err">$</span> <span class="o">+</span> <span class="n">CrLf</span><span class="err">$</span> <span class="o">+</span> <span class="n">CrLf</span><span class="err">$</span>
    <span class="n">PUT</span> <span class="p">#</span><span class="n">Client</span><span class="o">&amp;</span><span class="p">,</span> <span class="p">,</span> <span class="n">Request</span><span class="err">$</span>
    <span class="n">DO</span><span class="p">:</span> <span class="n">_LIMIT</span> <span class="mi">20</span> <span class="c1">'              load response header</span>
      <span class="n">GET</span> <span class="p">#</span><span class="n">Client</span><span class="o">&amp;</span><span class="p">,</span> <span class="p">,</span> <span class="n">Dat</span><span class="err">$</span>
      <span class="n">Header</span><span class="err">$</span> <span class="o">=</span> <span class="n">Header</span><span class="err">$</span> <span class="o">+</span> <span class="n">Dat</span><span class="err">$</span>
    <span class="n">LOOP</span> <span class="n">UNTIL</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">Header</span><span class="err">$</span><span class="p">,</span> <span class="n">CrLf</span><span class="err">$</span> <span class="o">+</span> <span class="n">CrLf</span><span class="err">$</span><span class="p">)</span> <span class="c1">' Loop until 2 CRLFs (end of HTML header) are found</span>
    <span class="n">PRINT</span> <span class="s">"Header Done."</span>

    <span class="c1">' Get file size from header</span>
    <span class="n">SizePos</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">UCASE</span><span class="err">$</span><span class="p">(</span><span class="n">Header</span><span class="err">$</span><span class="p">),</span> <span class="s">"CONTENT-LENGTH:"</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span>
    <span class="n">SizeEnd</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">SizePos</span><span class="p">,</span> <span class="n">Header</span><span class="err">$</span><span class="p">,</span> <span class="n">CrLf</span><span class="err">$</span><span class="p">)</span>
    <span class="n">FileSize</span><span class="o">&amp;</span> <span class="o">=</span> <span class="n">VAL</span><span class="p">(</span><span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">Header</span><span class="err">$</span><span class="p">,</span> <span class="n">SizePos</span><span class="p">,</span> <span class="p">(</span><span class="n">SizeEnd</span> <span class="o">-</span> <span class="n">SizePos</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">PRINT</span> <span class="s">"File size is"</span><span class="err">;</span> <span class="n">FileSize</span><span class="o">&amp;</span><span class="err">;</span> <span class="s">"bytes"</span>
    <span class="n">EndPos</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">Header</span><span class="err">$</span><span class="p">,</span> <span class="n">CrLf</span><span class="err">$</span> <span class="o">+</span> <span class="n">CrLf</span><span class="err">$</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="n">Response</span><span class="err">$</span> <span class="o">=</span> <span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">Header</span><span class="err">$</span><span class="p">,</span> <span class="n">EndPos</span><span class="p">)</span> <span class="c1">' get data after header already downloaded</span>

    <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1">'// Get file name from original URL path if necessary</span>
    <span class="n">DO</span> <span class="c1">'// Change this to destination local file name and path...</span>
      <span class="n">posit</span> <span class="o">=</span> <span class="n">INSTR</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">IP_File</span><span class="err">$</span><span class="p">,</span> <span class="s">"/"</span><span class="p">)</span>
      <span class="n">IF</span> <span class="n">posit</span> <span class="n">THEN</span> <span class="n">lastpos</span> <span class="o">=</span> <span class="n">posit</span><span class="p">:</span> <span class="n">start</span> <span class="o">=</span> <span class="n">posit</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">LOOP</span> <span class="n">UNTIL</span> <span class="n">posit</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">File</span><span class="err">$</span> <span class="o">=</span> <span class="n">MID</span><span class="err">$</span><span class="p">(</span><span class="n">IP_File</span><span class="err">$</span><span class="p">,</span> <span class="n">lastpos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">'beware of tag suffixes</span>
    <span class="n">OPEN</span> <span class="n">File</span><span class="err">$</span> <span class="n">FOR</span> <span class="n">BINARY</span> <span class="n">AS</span> <span class="p">#</span><span class="mi">1</span>
    <span class="n">DO</span><span class="p">:</span> <span class="n">_LIMIT</span> <span class="mi">20</span>
      <span class="n">PUT</span> <span class="p">#</span><span class="mi">1</span><span class="p">,</span> <span class="p">,</span> <span class="n">Response</span><span class="err">$</span>
      <span class="n">GET</span> <span class="p">#</span><span class="n">Client</span><span class="o">&amp;</span><span class="p">,</span> <span class="p">,</span> <span class="n">Response</span><span class="err">$</span>
    <span class="n">LOOP</span> <span class="n">UNTIL</span> <span class="n">LOF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">FileSize</span><span class="o">&amp;</span>
    <span class="n">PRINT</span> <span class="s">"File download completed!"</span>
    <span class="n">CLOSE</span> <span class="p">#</span><span class="mi">1</span>
  <span class="n">ELSE</span>
    <span class="n">PRINT</span> <span class="s">"Failed to connect."</span>
  <span class="n">END</span> <span class="n">IF</span>
<span class="n">ELSE</span>
  <span class="n">PRINT</span> <span class="s">"Failed to create server connection..."</span>
<span class="n">END</span> <span class="n">IF</span> 

</code></pre></div></div>
<p><sub>Code suggested by Matt Kilgore</sub></p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">QB64.com maintained by <a href="https://github.com/DualBrain">Cory Smith</a> on <a href="https://github.com/DualBrain/QB64">GitHub</a>.</p>
        
        <p>Published with <a href="https://pages.github.com/">GitHub Pages</a></p>
      </footer>
    </div>
  </body>

<!-- Mirrored from qb64.com/wiki/Downloading-Files by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 07 Nov 2024 13:50:31 GMT -->
</html>